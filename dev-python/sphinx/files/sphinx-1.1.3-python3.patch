https://bitbucket.org/birkenfeld/sphinx/changeset/8aba132b1337

--- sphinx/ext/graphviz.py
+++ sphinx/ext/graphviz.py
@@ -121,9 +121,11 @@
 
 def render_dot(self, code, options, format, prefix='graphviz'):
     """Render graphviz code into a PNG or PDF output file."""
-    hashkey = code.encode('utf-8') + str(options) + \
+    hashkey = (code + str(options) + \
               str(self.builder.config.graphviz_dot) + \
               str(self.builder.config.graphviz_dot_args)
+              ).encode('utf-8')
+              
     fname = '%s-%s.%s' % (prefix, sha(hashkey).hexdigest(), format)
     if hasattr(self.builder, 'imgpath'):
         # HTML
--- sphinx/ext/inheritance_diagram.py
+++ sphinx/ext/inheritance_diagram.py
@@ -39,7 +39,7 @@
 import re
 import sys
 import inspect
-import __builtin__
+import __builtin__ as __builtin__ # as __builtin__ is for lib2to3 compatibility
 try:
     from hashlib import md5
 except ImportError:
@@ -314,7 +314,8 @@
 
 
 def get_graph_hash(node):
-    return md5(node['content'] + str(node['parts'])).hexdigest()[-10:]
+    encoded = (node['content'] + str(node['parts'])).encode('utf-8')
+    return md5(encoded).hexdigest()[-10:]
 
 
 def html_visit_inheritance_diagram(self, node):
